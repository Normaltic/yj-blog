---
title: React의 전역 상태를 직접 구현하기
date: 2025-05-20 13:00:00
summary: useSyncExternalStore를 활용하면 전역 상태를 직접 구현할 수 있다
---

간혹 프로젝트를 진행하다 보면, 인접한 컴포넌트들이 상태를 공유해야 하는 순간이 있다. 이럴 때, 보통은 상태 선언 위치를 재조정하여 props를 통해 전달하도록 한다.

그러나 해당 방법은 컴포넌트 사이의 거리가 멀 때 등 어느 정도 한계가 존재하여, 프로젝트의 복잡성이 증가하게 된다. 이 경우 보통 전역 상태를 추가하여 각 컴포넌트들이 상태를 공유하도록 만들어 문제를 해결할 수 있다.

전역 상태는 React의 Context API 나, 다양한 외부 라이브러리를 통해 정의할 수 있다. 대표적으로 React, Zustand가 있으며, 라이브러리를 사용한다면 전역 상태를 손 쉽게 정의하고 관리할 수 있게 된다.

그런데 꼭 외부 라이브러리를 사용해야 할까? React의 자체 기능만으로는 할 수 없을까? 같은 고민을 하던 도중, `useSyncExternalStore` API 를 접하게 되었다.

이 글에서는, 상태에 대한 고민과 `useSyncExternalStore`를 소개하고, 간단한 전역 상태를 구현해보고자 한다.

### React의 상태

React 컴포넌트는 자신만의 상태(state)를 가질 수 있다. 버튼의 클릭 횟수, 사용자가 입력한 값, 토글 상태 등 대부분의 UI 상태는 이 방식으로 관리된다.

React 컴포넌트는 클래스 컴포넌트와 함수형 컴포넌트 두 개로 나뉘고, 그 중 함수형 컴포넌트의 상태는 `useState` 라는 Hook을 통해 정의하여 사용할 수 있다.

이걸 통해 컴포넌트의 상태를 다룰 수 있다.

같은 상태를 다른 컴포넌트끼리 공유해야 하는 경우가 생길 수 있음

(카운터 예제)

이 경우, 같은 부모로 그 상태를 끌어올린다면 해결할 수 있다.

그런데 프로젝트의 구조가 복잡하거나, 컴포넌트 사이의 거리가 멀다면 상태를 정의하는 부모와의 차이가 너무 멀어짐

( 그림 )

점점 그 상황을 반복하다 보면, 상태가 정의된 곳과 실제 필요한 곳의 깊이가 많이 차이나게 됨

그러면 어떤 상태가 어느 위치에서 관리되고 있는지 찾기 어려워지고, props drill-down이 발생

그래서 다른 컴포넌트들 끼리 상태를 공유할 수 있는 효율적인 수단이 필요하게 되었음

### 전역 상태

그래서 전역 상태라는 개념이 등장하게 되었음

Context API 에 대한 설명

(예제 코드)

이를 통해 멀리 떨어진 컴포넌트들 끼리 상태를 공유할 수 있게 됨

하지만 단점이 존재하는데

컨텍스트의 상태가 변경된다면, Provider 하위의 컴포넌트는 전체 리렌더링 된다

( 그림 )

또한, Provider의 자식 트리에 데이터를 제공하기 떄문에, 여러 Context를 조합할 경우 복잡도가 증가한다.

( 코드 )

이를 위한 대안으로는, 외부 상태 관리 도구들이 있다.

Redux, Zustand에 대한 설명

하지만 외부 라이브러리이므로 프로젝트의 외부 의존성이 증가한다.

React 자체만으로 해결할 수 없을까?

### useSyncExternalStore

useSyncExternalStore는 React18 에 도입된 공식 구독 API 로, 훅에 대한 설명

useSyncExternalStore의 구조 설명

(코드)

subscribe, getSnapShot, getServerSnapShot 에 대한 설명

호환성에 대한 설명( SSR, StrictMode, )

이를 통해 외부 상태를 직접 구독하는 기능을 구현할 수 있다.

또한, 동기화되지 않는 외부 API 와도 연동할 수 있다.

공식 예제의 navigator.onLine 상태를 구독하는 예제

### 전역 상태 구현해보기

그럼 useSyncExternalStore를 사용해 간단한 전역 상태를 직접 만들어보도록 하자.

Counter 예제

### localStorage와 연동하기

useSyncExternalStore는 외부 API와도 연동할 수 있다고 했다.

메모리 대신, 로컬 스토리지에 상태를 저장하여 반영구적으로 유지되는 상태를 만들어보자

getSnapShot 을 바꾸면 된다

### 마치며

이 글을 작성하며 React18 부터 제공되는 `useSyncExternalStore`를 알아보았고, 이를 통해 전역 상태를 구현하고 외부 API 와의 연동까지 해 보았다.

해당 API를 들어는 봤으나 제대로 알아보가나 사용해본 적은 없었다. 사이드 프로젝트에서 상태 관리에 대한 고민을 하면서 알아보던 도중 다시 듣게 되었고, 이를 통해 어느 정도 해결할 수 있을것이라 판단했다. 그래서 API를 자세히 알아보고자 글을 작성하며 정리해 보았다.

아마 React를 지원하는 다양한 상태 관리 라이브러리도 이 기능을 사용해 구현하지 않았을까 하는 생각이 든다. 물론, API가 제공되기 이전의 버전에서는 Context API나, 다른 방법을 사용해 구현했겠지만.

다음에 간단한 상태 관리나 Web API를 연동할 일이 생기면, 해당 API를 통해 시도해볼 수 있을 것 같다.
